name: Deploy Lambdas
on:
  push:
    branches:
      - 'dev-*'
    branches-ignore:
      - 'main'

defaults:
  run:
    shell: bash
    working-directory: 'src/'


jobs:
  aws-deploy-dev:
    if: startsWith(github.ref_name, 'dev-')
    uses: ./.github/workflows/aws-deploy.yaml
    secrets: inherit
    with: 
      environment-name: development

  aws-deploy-ses-dev:
    if: startsWith(github.ref_name, 'dev-ses')
    uses: ./.github/workflows/aws-deploy.yaml
    secrets: inherit
    with: 
      environment-name: development-ses
      lambda-handler: ses.export

  aws-deploy-qa-prod:
    if: startsWith(github.ref_name, 'qa-')
    uses: ./.github/workflows/aws-deploy.yaml
    secrets: inherit
    with: 
      environment-name: production
